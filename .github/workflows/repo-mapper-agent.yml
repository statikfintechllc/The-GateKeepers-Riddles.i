name: Repository Mapper Agent

on:
  workflow_dispatch:  # Manual trigger only
    inputs:
      scan_type:
        description: 'Type of scan'
        required: false
        default: 'full'
        type: choice
        options:
          - full
          - incremental
          - quick

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  info:
    runs-on: ubuntu-latest
    steps:
      - name: Workflow Information
        run: |
          echo "üó∫Ô∏è Repository Mapper Agent Workflow"
          echo ""
          echo "This workflow has been updated to work with GitHub Copilot agent."
          echo ""
          echo "**How to use:**"
          echo "1. Create an issue with the 'mapper-request' label"
          echo "2. The auto-assign workflow will assign github-copilot[bot] to the issue"
          echo "3. GitHub Copilot agent will:"
          echo "   - Read the repo-mapper agent instructions"
          echo "   - Connect to SQLite database (system/database/)"
          echo "   - Perform AI-powered code analysis"
          echo "   - Extract functions, classes, dependencies"
          echo "   - Calculate complexity metrics"
          echo "   - Update database with metadata"
          echo "   - Generate output files (repo-map.json, code-index.json, etc.)"
          echo "   - Open a pull request for review"
          echo ""
          echo "**Manual trigger:**"
          echo "This workflow can still be triggered manually via workflow_dispatch"
          echo "for testing or special cases, but the primary flow is through"
          echo "GitHub Copilot agent assignment to issues."
          echo ""
          echo "**Database Integration:**"
          echo "The agent now uses the comprehensive SQLite database system"
          echo "located in system/database/ with:"
          echo "  - Full-text search (FTS5)"
          echo "  - Relational schema (20+ tables)"
          echo "  - Transaction support"
          echo "  - Scan history tracking"
          echo "  - CLI tools for querying"
          echo ""
          echo "**Verification:**"
          echo "After mapping, verify with:"
          echo "  cd system/database"
          echo "  npm run stats"
          echo "  ./cli/repo-db.js files"
          echo "  ./cli/repo-db.js functions"
          echo "  ./cli/repo-db.js search \"term\""
          echo ""
          echo "Scan Type: ${{ inputs.scan_type || 'full' }}"
          echo ""
          echo "For details, see: .github/agents/repo-mapper.agent.md"
